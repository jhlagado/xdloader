<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>xdloader remote</title>
</head>
<body>
    <script>


window.addEventListener('load', function load(event) {
    postMsg({
        name: 'remoteready',
    }, '*');
}, false);

window.addEventListener('message', function receiveMessage(e) {
    
    var msg = JSON.parse(e.data)
    if (msg.command == 'load') {
        var msg2 = {
            name: 'load.response',
            path: msg.path,
        };
        
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() 
        {
            if (xmlhttp.readyState == 4) {
                if (xmlhttp.status == 200 || xmlhttp.status == 0) {
                    
                    msg2.statuscode = 200;
                    try {
                        msg2.data = JSON.parse(xmlhttp.responseText);
                        msg2.result = 'ok';
                    } 
                    catch (e) {
                        msg2.statuscode = 400;
                        msg2.result = e.message;
                    }
                } 
                else {
                    msg2.statuscode = xmlhttp.status;
                    msg2.result = 'error';
                }
                postMsg(msg2, '*');
            }
        }
        xmlhttp.open("GET", msg.path, true);
        xmlhttp.send();
    }
}, false);

function postMsg(msg) {
    window.parent.postMessage(JSON.stringify(msg), '*');
}

</script>
</body>
</html>